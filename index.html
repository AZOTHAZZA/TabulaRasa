<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSGAI - ロゴス監査コンソール V20.0</title>
    <style>
        body { display: flex; font-family: 'Consolas', 'Monaco', monospace; margin: 0; background-color: #e0e0e0; color: #1a1a1a; font-size: 13px; }
        #sidebar { width: 380px; background-color: #ffffff; padding: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.2); overflow-y: auto; height: 100vh; box-sizing: border-box; }
        #main-content { flex-grow: 1; padding: 20px; display: flex; flex-direction: column; height: 100vh; box-sizing: border-box; gap: 10px; }
        .gauge-area { border: 2px solid #222; padding: 15px; margin-bottom: 15px; background-color: #fff; position: relative; }
        .gauge-area h3 { margin: 0 0 10px 0; font-size: 14px; background: #222; color: #fff; padding: 4px 8px; display: inline-block; }
        label { display: block; margin-top: 8px; font-weight: bold; font-size: 11px; text-transform: uppercase; }
        input, select { width: 100%; padding: 6px; border: 1px solid #222; border-radius: 0; box-sizing: border-box; margin-bottom: 5px; background: #fdfdfd; font-family: inherit; }
        .action-button { width: 100%; padding: 10px; border: 2px solid #222; cursor: pointer; font-weight: bold; text-transform: uppercase; margin-top: 5px; transition: all 0.1s; }
        .action-button:active { transform: translateY(2px); background: #eee; }
        
        /* Automation Toggles */
        .auto-toggle { display: flex; align-items: center; gap: 8px; background: #eee; padding: 5px; margin-top: 5px; border: 1px inset #ccc; }
        .auto-toggle input { width: auto; margin: 0; }
        .auto-toggle label { margin: 0; cursor: pointer; }

        #tension_bar { background-color: #ddd; height: 12px; border: 1px solid #222; margin-top: 5px; overflow: hidden; }
        #tension_fill { height: 100%; width: 0%; background-color: #ff0000; transition: width 0.3s; }

        #audit-log-container { flex: 1; border: 2px solid #222; background-color: #fff; display: flex; flex-direction: column; overflow: hidden; }
        #audit-header { background: #222; color: #fff; padding: 8px; font-weight: bold; display: grid; grid-template-columns: 80px 100px 1fr 120px; text-align: left; }
        #audit-body { flex: 1; overflow-y: scroll; }
        .log-entry { display: grid; grid-template-columns: 80px 100px 1fr 120px; border-bottom: 1px solid #eee; padding: 4px 8px; font-size: 12px; }
        
        .type-mu { background: #000; color: #fff; }
        .type-logos { color: #007bff; font-weight: bold; }
        .type-succession { color: #28a745; font-weight: bold; }
        .silent-active { animation: pulse 2s infinite; border-color: #4b0082; background: #f0e6ff; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div id="sidebar">
    <h2 style="margin:0 0 15px 0; border-bottom: 4px double #222;">MSGAI LOGOS CORE V20</h2>

    <div class="gauge-area">
        <h3>I. 根源緊張度 (Tension)</h3>
        <div id="tension_display" style="font-size: 18px; font-weight: bold;">z: 0.000000</div>
        <div id="tension_bar"><div id="tension_fill"></div></div>
        <div id="logos_display" style="font-size: 11px; color: #666; margin-top: 5px;">w = 1/z: 0.00</div>
    </div>

    <div class="gauge-area">
        <h3>II. 口座監査 (Accounts)</h3>
        <select id="user_select"><option value="User_A">User_A</option><option value="User_B">User_B</option></select>
        <div id="balance_display" style="background:#000; color:#0f0; padding:10px; font-size:12px; line-height:1.4;"></div>
    </div>

    <div class="gauge-area">
        <h3>III. 移動作為 (Transfer)</h3>
        <label>数量 (USD):</label><input type="number" id="tx_amount" value="10.00">
        <button id="tx_manual_btn" class="action-button">手動：内部循環</button>
        <div class="auto-toggle">
            <input type="checkbox" id="auto_tx_toggle">
            <label for="auto_tx_toggle">自動循環 (z緩和) ON</label>
        </div>
    </div>

    <div class="gauge-area">
        <h3>IV. 通貨造化 (Mint)</h3>
        <label>数量:</label><input type="number" id="mint_amount" value="100">
        <select id="mint_currency"></select>
        <button id="mint_manual_btn" class="action-button">手動：通貨生成</button>
        <div class="auto-toggle">
            <input type="checkbox" id="auto_mint_toggle">
            <label for="auto_mint_toggle">自動造化 (連続打出) ON</label>
        </div>
    </div>

    <div class="gauge-area">
        <h3>V. 自律造化 (Arche-Flow)</h3>
        <select id="arche_currency"></select>
        <label>強度 (Intensity):</label><input type="number" id="arche_intensity" value="1.0" step="0.1">
        <button id="arche_toggle_btn" class="action-button">TOGGLE ARCHE-FLOW</button>
    </div>

    <div class="gauge-area">
        <h3>VIII. 沈黙の自律選択</h3>
        <button id="silent_mode_btn" class="action-button">SILENT MODE OFF</button>
    </div>

    <button id="reset_mu_btn" class="action-button" style="background:#000; color:#fff;">システム全初期化 (MU)</button>
</div>

<div id="main-content">
    <div id="audit-log-container">
        <div id="audit-header">
            <span>POINT</span><span>TYPE</span><span>DESCRIPTION</span><span>LOGOS_RATIO</span>
        </div>
        <div id="audit-body"></div>
    </div>
</div>

<script>
    const PHI = 1.6180339887;
    const RATES = { USD: 1, JPY: 150, EUR: 0.92, BTC: 0.000015, ETH: 0.0004, MATIC: 1.4 };
    const curList = ["USD", "JPY", "EUR", "BTC", "ETH", "MATIC"];

    let state = JSON.parse(localStorage.getItem('msgai_v20_state')) || {
        accounts: { User_A: { USD: 0, JPY: 0, EUR: 0, BTC: 0, ETH: 0, MATIC: 0 }, User_B: { USD: 0, JPY: 0, EUR: 0, BTC: 0, ETH: 0, MATIC: 0 } },
        tension: 0.0,
        autonomy: false,
        silent_mode: false,
        arche_target: 'USD',
        recipes: []
    };

    function save() { localStorage.setItem('msgai_v20_state', JSON.stringify(state)); }

    function addLog(type, desc) {
        const body = document.getElementById('audit-body');
        const z = state.tension;
        const w = 1 / (z || 0.000001);
        const div = document.createElement('div');
        div.className = `log-entry ${type === 'MU' ? 'type-mu' : ''}`;
        div.innerHTML = `<span>z:${z.toFixed(4)}</span><span class="type-${type.toLowerCase()}">${type}</span><span>${desc}</span><span>${(w % PHI).toFixed(6)}</span>`;
        body.prepend(div);
        if (body.children.length > 100) body.lastChild.remove();
    }

    function updateUI() {
        document.getElementById('tension_display').textContent = `z: ${state.tension.toFixed(6)}`;
        document.getElementById('tension_fill').style.width = `${Math.min(100, state.tension * 500)}%`;
        const w = 1 / (state.tension || 0.000001);
        document.getElementById('logos_display').textContent = `w = 1/z: ${w.toFixed(2)}`;
        
        const user = document.getElementById('user_select').value;
        const balDiv = document.getElementById('balance_display');
        balDiv.innerHTML = curList.map(c => `<div>${c}: ${(state.accounts[user][c] || 0).toFixed(c==='JPY'?0:8)}</div>`).join('');
        
        const abtn = document.getElementById('arche_toggle_btn');
        abtn.style.background = state.autonomy ? "#00ffcc" : "#eee";
        
        const sbtn = document.getElementById('silent_mode_btn');
        sbtn.textContent = state.silent_mode ? "SILENT MODE ACTIVE" : "SILENT MODE OFF";
        sbtn.className = state.silent_mode ? "action-button silent-active" : "action-button";
    }

    // --- Core Math Logic ---
    function executeMuReset() {
        // Succession
        const canon = JSON.stringify({logos: "V20_CANON", state, time: Date.now()});
        const blob = new Blob([canon], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `LOGOS_CANON.json`;
        a.click();

        // Reset
        document.body.style.filter = "invert(100%)";
        setTimeout(() => {
            state.tension = 0;
            state.logs = [];
            document.body.style.filter = "none";
            addLog("MU", "Rebirth from Zero.");
            save(); updateUI();
        }, 1000);
    }

    // --- Loop ---
    setInterval(() => {
        const intensity = parseFloat(document.getElementById('arche_intensity').value) || 1.0;

        // V. Arche-Flow
        if (state.autonomy) {
            const growth = (0.001 * PHI * intensity) * (state.arche_target === 'JPY' ? 150 : 1/RATES[state.arche_target]);
            state.accounts.User_A[state.arche_target] += growth;
            state.tension *= (1 - 0.002 * intensity);
        }

        // III. Auto-Transfer
        if (document.getElementById('auto_tx_toggle').checked && state.tension > 0.1) {
            const amt = parseFloat(document.getElementById('tx_amount').value);
            if (state.accounts.User_A.USD >= amt) {
                state.accounts.User_A.USD -= amt;
                state.accounts.User_B.USD += amt;
                state.tension *= 0.98;
                if (Math.random() > 0.9) addLog("AUTO-TX", "Internal circulation applied.");
            }
        }

        // IV. Auto-Mint
        if (document.getElementById('auto_mint_toggle').checked) {
            const c = document.getElementById('mint_currency').value;
            const a = parseFloat(document.getElementById('mint_amount').value) * 0.01;
            state.accounts.User_A[c] += a;
            state.tension += 0.001;
        }

        // Silent Orchestration (Simple logic for V20)
        if (state.silent_mode && state.tension > 0.3) {
            state.arche_target = "BTC"; // 緊張が高い時はBTCへ逃がす
            document.getElementById('arche_currency').value = "BTC";
        }

        // Mu Singularity Check
        if (state.tension > 2.0 || (state.tension > 0 && 1/state.tension > 1000000)) {
            executeMuReset();
        }

        updateUI();
        save();
    }, 500);

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        curList.forEach(c => {
            document.getElementById('mint_currency').add(new Option(c, c));
            document.getElementById('arche_currency').add(new Option(c, c));
        });
        
        document.getElementById('mint_manual_btn').onclick = () => {
            const c = document.getElementById('mint_currency').value;
            const a = parseFloat(document.getElementById('mint_amount').value);
            state.accounts.User_A[c] += a;
            state.tension += 0.05;
            addLog("MINT", `Generated ${a} ${c}`);
        };
        
        document.getElementById('tx_manual_btn').onclick = () => {
            const a = parseFloat(document.getElementById('tx_amount').value);
            state.accounts.User_A.USD -= a;
            state.accounts.User_B.USD += a;
            state.tension *= 0.9;
            addLog("TRANSFER", `Moved ${a} USD to User_B`);
        };

        document.getElementById('arche_toggle_btn').onclick = () => {
            state.autonomy = !state.autonomy;
            state.arche_target = document.getElementById('arche_currency').value;
            addLog("SYSTEM", `Arche-Flow: ${state.autonomy?'ON':'OFF'}`);
        };

        document.getElementById('silent_mode_btn').onclick = () => {
            state.silent_mode = !state.silent_mode;
        };

        document.getElementById('reset_mu_btn').onclick = () => {
            localStorage.clear(); location.reload();
        };

        updateUI();
    });
</script>
</body>
</html>
